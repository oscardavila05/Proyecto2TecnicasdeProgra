@page "/neo4j-data"
@inject Proyecto2Ferreteria.Services.Neo4jConnection Neo4jConnection

<h3>Datos de Productos</h3>

@if (nodes == null)
{
    <p>Cargando...</p>
}
else
{
    <ul>
        @foreach (var node in nodes)
        {
            <li>@node</li>
        }
    </ul>
}

@code {
    private List<string> nodes;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Consulta para obtener nodos con la etiqueta Producto
            var query = "MATCH (p:Producto) RETURN p LIMIT 10";
            var result = await Neo4jConnection.RunQueryAsync(query);
            nodes = new List<string>();

            await foreach (var record in result)
            {
                var node = record["p"].As<INode>();
                var properties = node.Properties;
                var formattedProperties = $"ID: {properties["Producto_id"]}, Nombre: {properties["ProductoNombre"]}, Precio: {properties["Precio"]}";
                nodes.Add(formattedProperties);
            }
        }
        catch (Exception ex)
        {
            // Manejo de errores
            nodes = new List<string> { $"Error: {ex.Message}" };
        }
    }
}
